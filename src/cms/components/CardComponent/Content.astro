---
import type {
    CardFragment,
    DisplaySettingsFragment,
} from '../../../../__generated/sdk';
import type { ContentPayload } from '../../../graphql/shared/ContentPayload';
import LinkButton from '../ButtonComponent/LinkButton.astro';
// import { getCardStyles } from './CardStyling';
import { getButtonStyles } from '../ButtonComponent/ButtonStyling';
import { getCardTextAlignmentStyle, getCardHeaderStyles } from './CardStyling';

export interface Props {
    data: CardFragment;
    displaySettings: DisplaySettingsFragment[];
    displayTemplateKey: string;
    contentPayload: ContentPayload;
    DisplayAs?: string;
    widthClass?: string;
    verticalAlignClass?: string;
    isFullSplit?: boolean;
    globalStyles?: string[];
}
const { data, displaySettings, DisplayAs, widthClass, verticalAlignClass, isFullSplit, globalStyles } = Astro.props as Props;
const cardButtonStyles = getButtonStyles(displaySettings, false); // false: button type defined here
const cardTextAlignmentStyle = getCardTextAlignmentStyle(displaySettings);
const cardHeaderStyles = getCardHeaderStyles(displaySettings);

// Button type mapping for cleaner code
const buttonTypes = ['btn-primary', 'btn-secondary', 'btn-accent', 'btn-info', ''];
const getButtonType = (index: number) => buttonTypes[index] || 'btn-primary';

const cssClassesSection = {
    textOnRight: 'content-center',
    textOnLeft: 'content-center',
    textAboveCard: 'text-center',
    textBelowCard: 'text-center',
};
const cssTextClasses = {
    textOnRight: 'mt-0',
    textOnLeft: 'mt-0',
    textAboveCard: 'mt-2',
    textBelowCard: 'mt-2',
};
const cssClassesCallToAction = {
    textOnRight: 'z-20 mt-8 flex gap-2 flex-wrap',
    textOnLeft: 'z-20 mt-8 flex gap-2 flex-wrap',
    textAboveCard: 'z-20 mt-8 flex justify-center gap-2 flex-wrap',
    textBelowCard: 'z-20 mt-8 flex justify-center gap-2 flex-wrap',
};
type DisplayAsType =
    | 'textOnRight'
    | 'textOnLeft'
    | 'textAboveCard'
    | 'textBelowCard';
const displayAs: DisplayAsType =
    (DisplayAs as DisplayAsType) ?? (data?.DisplayAs as DisplayAsType) ?? 'textOnRight';
const cssClassesForSection: string = cssClassesSection[displayAs];
const cssClassesForCallToAction: string = cssClassesCallToAction[displayAs];
const cssClassesForText: string = cssTextClasses[displayAs];

// For full split layout, content takes exactly 50% with background applied
const containerClasses = isFullSplit 
    ? `w-full md:w-1/2 flex flex-col justify-center p-8 md:p-12 lg:p-16 ${cardTextAlignmentStyle} overflow-hidden`
    : `${widthClass || 'flex-1'} ${cssClassesForSection} ${cardTextAlignmentStyle} ${verticalAlignClass || 'self-center'}`;

// Build final classes including global styles for split mode
const contentClasses = isFullSplit
    ? [containerClasses, ...(globalStyles ?? [])]
    : [containerClasses];
---

<div class:list={contentClasses}>
    {data.Heading && (
        <h2 class={`text-4xl font-bold ${cardHeaderStyles}`} class:list={cssClassesForText}>
            {data.Heading}
        </h2>
    )}
    {data.SubHeading && (
        <p class="text-sm font-semibold opacity-80" class:list={cssClassesForText}>
            {data.SubHeading}
        </p>
    )}
    {data.Body?.html && (
        <div class={`${cssClassesForText} opacity-75`} set:html={data.Body.html}></div>
    )}
    {data.Links && data.Links.length > 0 && (
        <div class={cssClassesForCallToAction}>
            {
                data.Links.map((link, i) => {
                    const buttonType = ['', getButtonType(i)];
                    return (
                        <LinkButton cssClasses={[buttonType, cardButtonStyles]} link={link?.url?.default}>{link?.text}</LinkButton>
                    );
                })
            }
        </div>
    )}
</div>
