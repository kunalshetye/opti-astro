---
import type { CompositionStructureNode } from '../../../../__generated/sdk';
import type { ContentPayload } from '../../../graphql/shared/ContentPayload';
import Column from '../Column/Column.astro';
import CarouselRow from './CarouselRow.astro';
import { getRowStyles } from './RowHelper';
import { getSimpleRowStyles } from './SimpleRowHelper';
import { getGlobalStyles } from '../../shared/globalStylesHelper';
import { getDictionaryFromDisplaySettings } from '../../../graphql/shared/displaySettingsHelpers.ts';

export interface Props {
    row: any;
    contentPayload: ContentPayload;
}
const { row, contentPayload } = Astro.props as Props;
const rowNode = row as CompositionStructureNode;
const displayTemplateKey = rowNode.displayTemplateKey;

// Get columnsPerRow setting to pass to children
const displaySettings = rowNode.displaySettings;
const dictionary = getDictionaryFromDisplaySettings(displaySettings);
const columnsPerRow = dictionary['columnsPerRow'] ?? 'auto';

// Use appropriate helper based on template
let rowStyles;
if (displayTemplateKey === 'SimpleRow') {
    rowStyles = getSimpleRowStyles(rowNode);
} else {
    // AdvancedRow or any other row template
    rowStyles = getRowStyles(rowNode);
}

const globalStyles = getGlobalStyles(rowNode);
const styles = [...rowStyles, ...globalStyles];

// Check if horizontal padding should be removed
const noPadding = dictionary['horizontalPadding'] === 'none';
const paddingClass = noPadding ? '' : 'p-1';
---

<!--<h2>this is a row</h2>-->
{
    displayTemplateKey !== 'CarouselRow' && (
        <div
            class={`vb:row grid w-full justify-start ${paddingClass}`}
            class:list={styles}
        >
            {row.nodes?.map((column: any) => (
                <Column contentPayload={contentPayload} column={column} parentColumnsPerRow={columnsPerRow} />
            ))}
        </div>
    )
}

{
    displayTemplateKey === 'CarouselRow' && (
        <div
            class="vb:row row-carousel w-full"
            class:list={globalStyles}
        >
            <CarouselRow contentPayload={contentPayload} row={row} />
        </div>
    )
}
