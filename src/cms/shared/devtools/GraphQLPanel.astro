---
import { getGraphQLQueries } from '../../../graphql/getSdk';
import DevToolsPanel from './DevToolsPanel.astro';

// Get GraphQL queries for dev mode
const graphqlQueries = getGraphQLQueries();
---

<DevToolsPanel title="GraphQL Queries" sectionKey="graphql" badge={graphqlQueries.length}>
    <div class="space-y-4">
        {graphqlQueries.length === 0 ? (
            <p class="text-sm text-base-content opacity-70 font-mono">No GraphQL queries captured yet. Navigate to different pages to see queries.</p>
        ) : (
            graphqlQueries.map((queryData, index) => (
                <div class="bg-base-100 rounded-lg border border-base-300 overflow-hidden">
                    <div class="px-4 py-2 bg-base-200 border-b border-base-300 flex justify-between items-center">
                        <span class="text-xs font-mono text-base-content opacity-70">
                            Query #{graphqlQueries.length - index} - {queryData.timestamp.toLocaleTimeString()}
                        </span>
                        <button 
                            @click="navigator.clipboard.writeText($el.closest('.bg-base-100').querySelector('pre').textContent)"
                            class="text-xs text-primary hover:text-primary-focus transition-colors"
                            title="Copy query"
                        >
                            Copy
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="mb-3">
                            <h4 class="text-xs font-semibold text-base-content mb-2">GraphQL Query:</h4>
                            <pre 
                                class="text-xs bg-neutral text-neutral-content p-3 rounded overflow-x-auto font-mono whitespace-pre"
                            >{queryData.query}</pre>
                        </div>
                        {queryData.variables && Object.keys(queryData.variables).length > 0 && (
                            <div>
                                <h4 class="text-xs font-semibold text-base-content mb-2">Variables:</h4>
                                <pre class="text-xs bg-neutral text-neutral-content p-3 rounded overflow-x-auto font-mono">
                                    {JSON.stringify(queryData.variables, null, 2)}
                                </pre>
                            </div>
                        )}
                    </div>
                </div>
            ))
        )}
    </div>
</DevToolsPanel>