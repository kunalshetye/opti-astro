query facetedSearch(
    $searchTerm: String
    $locale: [Locales]
    $domain: String
    $limit: Int = 20
    $offset: Int = 0
    $orderBy: ArticlePageOrderByInput
    $orderByExperience: _ExperienceOrderByInput
    $authorFilters: [String!]
    $typeFilters: [String!]
) {
    # Main content results - ArticlePage
    ArticlePage(
        locale: $locale
        limit: $limit
        skip: $offset
        orderBy: $orderBy
        where: {
            _and: [
                # Domain filter (always applied)
                { _metadata: { url: { base: { eq: $domain } } } }
                # Content type filter (optional - null value is ignored)
                { _metadata: { types: { in: $typeFilters } } }
                # Status filter - only show published content
                { _metadata: { status: { eq: "Published" } } }
            ]
            # Full-text search filter (optional - null value is ignored)
            _fulltext: { match: $searchTerm, fuzzy: true, synonyms: ONE }
            # Author filter (optional - null value is ignored)
            Author: { in: $authorFilters }
        }
        usePinned: { phrase: $searchTerm }
    ) {
        total
        items {
            _metadata {
                key
                displayName
                published
                url {
                    default
                    hierarchical
                    base
                }
                types
            }
            Heading
            SubHeading
            Author
            PromoImage {
                ...ContentUrl
            }
            Body {
                html
            }
        }
        facets {
            # Author facet
            Author(
                filters: $authorFilters
                orderType: COUNT
                orderBy: DESC
                limit: 50
            ) {
                name
                count
            }
            # Content types facet
            _metadata {
                types(
                    filters: $typeFilters
                    orderType: COUNT
                    orderBy: DESC
                    limit: 20
                ) {
                    name
                    count
                }
            }
        }
    }

    # Experience results
    _Experience(
        locale: $locale
        limit: $limit
        skip: $offset
        orderBy: $orderByExperience
        where: {
            _and: [
                # Domain filter (always applied)
                { _metadata: { url: { base: { eq: $domain } } } }
                # Content type filter (optional - null value is ignored)
                { _metadata: { types: { in: $typeFilters } } }
                # Status filter - only show published content
                { _metadata: { status: { eq: "Published" } } }
            ]
            # Full-text search filter (optional - null value is ignored)
            _fulltext: { match: $searchTerm, fuzzy: true, synonyms: ONE }
        }
        usePinned: { phrase: $searchTerm }
    ) {
        total
        items {
            _metadata {
                key
                displayName
                published
                url {
                    default
                    hierarchical
                    base
                }
                types
            }
            _fulltext
            # Get SEO settings and images for specific Experience types
            ... on BlankExperience {
                BlankExperienceSeoSettings {
                    MetaTitle
                    MetaDescription
                    SharingImage {
                        ...ContentUrl
                    }
                }
            }
        }
        facets {
            # Content types facet
            _metadata {
                types(
                    filters: $typeFilters
                    orderType: COUNT
                    orderBy: DESC
                    limit: 20
                ) {
                    name
                    count
                }
            }
        }
    }
}
